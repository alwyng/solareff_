<!DOCTYPE HTML>
<html>
	<head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
	    <meta name="mobile-web-app-capable" content="yes">
	    <meta name="apple-mobile-web-app-capable" content="yes">
	    <meta name="apple-mobile-web-app-status-bar-style" content="black">		
		<title>Solareff</title>
		<script type="text/javascript" charset="utf-8" src="../cordova.js"></script>
		<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
		<script type="text/javascript" charset="utf-8">
			var pictureSource;   // picture source
			var destinationType; // sets the format of returned value

			// Wait for device API libraries to load
			//
			document.addEventListener("deviceready",onDeviceReady,false);

			// device APIs are available
			//
			function onDeviceReady() 
			{
				pictureSource=navigator.camera.PictureSourceType;
				destinationType=navigator.camera.DestinationType;
				alert('submit ready');
			}
			
			document.addEventListener("deviceready",onDeviceReady,false);
			function onDeviceReady()
			{
				/*if (cordova.plugins.email) {
					alert('Cordova available');
				};
				alert('Device Ready');*/
			}
			
			function onFail(message) 
			{
				setTimeout(function() {
					alert('Failed because: ' + message);
				}, 0);
				
			}
			
			function onPhotoDataSuccess(imageData) 
			{
					
				  // Uncomment to view the base64-encoded image data
				  // console.log(imageData);

				  // Get image handle
				  //
				  //var smallImage = document.getElementById('smallImage');

				  // Unhide image elements
				  //
				  //smallImage.style.display = 'block';

				  // Show the captured photo
				  // The in-line CSS rules are used to resize the image
				  //
				  //alert('222');
				  //smallImage.src = "data:image/jpeg;base64," + imageData;
				 
				  //document.getElementById('myP').innerHTML = imageData;
				  
				  //alert('333');
				  
				  setTimeout(function() {
					try {
						var arrRoomList = localStorage.roomList.split(';');
						var strEmailBody = 'Room,Quantity,Number Items\n';
						var arrRoomDetail;
						for (var i=0;i<arrRoomList.length;i++) {
							arrRoomDetail = localStorage.getItem(arrRoomList[i]).split(';');
							for (var j=0;j<arrRoomDetail.length;j++) {
								if (arrRoomDetail[j]!="") {
									strEmailBody += arrRoomList[i]+","+arrRoomDetail[j]+"\n";
								}
							}
						}
					
						cordova.plugins.email.open({
							to:      'alwyn.grobler@gmail.com',
							cc:      [],
							bcc:     [],
							subject: 'Solareff App Result',
							body:    "Copy and paste the following lines into excel:\n"+strEmailBody,
							attachments: 'base64:bill.jpg//'+imageData
						});
					}
					catch(err) {
						alert(err.message);
					}
					//alert('444.1');
				  }, 0);
				  
				  //alert('444.2');
			}
			
			function capturePhoto() 
			{
				try
				{
					// Take picture using device camera and retrieve image as base64-encoded string
					navigator.camera.getPicture(onPhotoDataSuccess, onFail, { quality: 50,destinationType: Camera.DestinationType.DATA_URL });
				}
				catch(err) {
					alert(err.message);
				}
			}
		
			function getBase64Image(img) {
				// Create an empty canvas element
				var canvas = document.createElement("canvas");
				canvas.width = img.width;
				canvas.height = img.height;

				// Copy the image contents to the canvas
				var ctx = canvas.getContext("2d");
				ctx.drawImage(img, 0, 0);

				// Get the data-URL formatted image
				// Firefox supports PNG and JPEG. You could check img.src to
				// guess the original format, but be aware the using "image/jpg"
				// will re-encode the image.
				var dataURL = canvas.toDataURL("image/png");

				return dataURL.replace(/^data:image\/(png|jpg);base64,/, "");
			}
			
			function test()
			{
				var image = document.getElementById('myImage');
				
			}
		</script>
		<link rel="stylesheet" type="text/css" href="../css/style.css" />
	    <link rel="stylesheet" href="../css/framework7.ios.css">
	    <link rel="stylesheet" href="../css/framework7.ios.colors.css">
	    <link rel="stylesheet" href="../css/kitchen-sink.css">
	    <link rel="icon" href="../res/icon/img/logo.png">
	    <link rel="apple-touch-icon" href="../res/icon/img/logo.png">		
		<script src="../js/recalc.js"></script>
		<script src="../js/submit.js"></script>
	</head>
	<body onload="load()">
	    <div class="statusbar-overlay">    	
	    </div>
	    <div class="views">
	      <div class="view view-main">
	        <div class="navbar">
	          <div class="navbar-inner">
	        	<div class="left sliding"><a href="main.html" class="back link"><i class="icon icon-back"></i><span>Back</span></a></div>	            	
	            <div class="center sliding">Sunmission</div>
	            <div class="right">
	            </div>
	          </div>
	        </div>
	        <div class="pages navbar-through toolbar-through">
          		<div class="page">
            		<div class="page-content">
						<a href="http://www.solareff.co.za">
							<img src="../res/icon/img/logo.jpg">
						</a>  
						<form class="center" name="frmKwh" action="">
							<input type="text" name="txtKwh" disabled>
						</form>
						<h3>Submit to Solareff</h3>
						<!--<a href="main.html">
							<input type="button" name="btnBack" value="Back">
						</a>-->
						<script type="text/javascript" src="../cordova.js"></script>
						<script type="text/javascript" src="../js/index.js"></script>
						
						<div>
							<script>
								var arrRoomList = localStorage.roomList.split(';');
								var strEmailBody = 'Room,Quantity,Number Items\n';
								var arrRoomDetail;
								var arrAppDetail;
								for (var i=0;i<arrRoomList.length;i++) {
									arrRoomDetail = localStorage.getItem(arrRoomList[i]).split(';');
									for (var j=0;j<arrRoomDetail.length;j++) {
										if (arrRoomDetail[j]!="") {
											arrAppDetail = arrRoomDetail[j].split(',');
											if (j==0) {
												document.write("<br>");
												document.write(arrRoomList[i]+" <br>");
												document.write("&nbsp&nbsp&nbsp"+arrAppDetail[0]+"\t"+"Hours="+arrAppDetail[1]+"\t Quantity="+arrAppDetail[2])+" <br>";
												document.write("<br>");
											} else {
												document.write("&nbsp&nbsp&nbsp"+arrAppDetail[0]+"\t"+"Hours="+arrAppDetail[1]+"\t Quantity="+arrAppDetail[2])+" <br>";
												document.write("<br>");
											}
										}
									}
								}
								
							</script>
						</div>
									
						<input class="button button-big" type="button" name="btnSubmit" onclick="capturePhoto();" value="Take photo and submit information">
						
									</div>
								</div>
							</div>
							<div class="toolbar">
								<div class="toolbar-inner">
									<a href="contact_us.html" class="link">Contact Us
									</a>
									<a href="faq.html" class="link">FAQ
									</a>
								</div>
							</div>			
	       </div>
	      </div>	          	    
	</body>
</html>
